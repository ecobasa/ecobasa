{% extends "cosinnus/base.html" %}
{% load i18n thumbnail cosinnus_tags %}

{% block page_title %}{% trans "Caravans" %}{% endblock %}

{% block content %}
    <h1>{% trans "The available caravans for the Community-Tour" %}</h1>
    {% if user.is_authenticated %}
    <a class="btn btn-primary pull-right" href="{% url 'caravan-add' %}">{% trans "Add a caravan" %}</a>
    {% endif %}

    {% if object_list %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>{% trans "Caravan" %}</th>
                <th>{% trans "Description" %}</th>
                <th>{% trans "Members" %}</th>
                <th>{% trans "Buses" %}</th>
                <td>{% trans "Actions" %}</th>
            </tr>
        </thead>

        {% for caravan in object_list %}
        <tr>
            <td><a href="{% url 'caravan-detail' caravan.slug %}">{{ caravan.name }}</a></td>
            <td>{{ caravan.description|linebreaksbr|safe }}</td>
            <td>
              <ul>
                {% for amb in object.ambassadors %}
                <li>
                  <a class="pull-left" href="{% url 'pioneer-detail' username=amb.username %}">
                    {% if amb.cosinnus_profile.avatar %}
                      <img class="avatar" src="{{ amb.cosinnus_profile.avatar|thumbnail_url:"avatar_medium" }}" alt="{{ amb.get_full_name|default:amb.username }}" data-toggle="tooltip" data-placement="top" title="{{ amb.get_full_name|default:amb.username }}">
                    {% else %}
                      <img class="avatar" src="http://placehold.it/30x30">
                    {% endif %}
                  </a>
                </li>
                {% endfor %}
              </ul>
            </td>
            <td>
              {% if member.cosinnus_profile.bus_image %}<a href="{% url bus %}"></a><img src="{{ member.cosinnus_profile.bus_image|thumbnail_url:"bus_medium" }}" />{% endif %}
            </td>
            <td>
              <div class="btn-group">
              {% if user|is_group_member:caravan %}
                <a class="btn btn-primary" href="{% url 'caravan-leave' caravan.slug %}">{% trans "Leave" %}</a>
              {% elif user.is_authenticated %}
                <a class="btn btn-primary" href="{% url 'caravan-join' caravan.slug %}">{% trans "Join" %}</a>
              {% endif %}

              {% if user.is_superuser or user|is_group_admin:caravan %}
                <a class="btn btn-primary btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="{% url 'caravan-edit' caravan.slug %}"><span class="glyphicon glyphicon-pencil"></span> {% trans "Edit" %}</a>
                  {% if user.is_superuser %}
                  <li><a href="{% url 'caravan-delete' caravan.slug %}"><span class="glyphicon glyphicon-trash"></span> {% trans "Delete" %}</a>
                  {% endif %}
                </ul>
              {% endif %}
              </div>
          </td>
        </tr>
        {% endfor %}

    </table>
    {% else %}
        {% trans "There are no caravans, yet! " %}
        {% if user.is_authenticated %}
            <a href="{% url 'caravan-add' %}">{% trans "Add a caravan" %}</a>
        {% else %}
            <a href="{% url 'register' %}">{% trans "Sign up" %}</a>{% trans "and add one now." %}
        {% endif %}
    {% endif %}
{% endblock %}
